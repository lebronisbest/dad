# UI ë¸Œë¦¿ì§€ (UI Bridge) - ì•ˆì „ë³´ê³ ì„œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

## ê°œìš”

UI ë¸Œë¦¿ì§€ëŠ” MCP íˆ´ í˜¸ì¶œ ê²°ê³¼ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì›¹ UIì— ë°˜ì˜í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì±„íŒ…ìœ¼ë¡œ ìš”ì²­í•˜ë©´ í™”ë©´ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì–´ ë”ìš± ì§ê´€ì ì´ê³  ë°˜ì‘ì„± ìˆëŠ” ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### ğŸš€ ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸
- **í•„ë“œ ìë™ ì±„ìš°ê¸°**: "í•„ë“œ ìë™ìœ¼ë¡œ ì±„ì›Œì¤˜" â†’ ë³´ê³ ì„œ í¼ì´ ì¦‰ì‹œ ì™„ì„±
- **ê²€ì¦ ê²°ê³¼ í‘œì‹œ**: "ê²€ì¦í•´ì¤˜" â†’ ë¬¸ì œê°€ ìˆëŠ” í•„ë“œê°€ ê°•ì¡°ë˜ê³  ìˆ˜ì • ê°€ì´ë“œ ì œê³µ
- **PDF ìƒì„± ì§„í–‰ë¥ **: "PDF ë§Œë“¤ì–´" â†’ ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œ

### ğŸ”Œ Socket.IO ê¸°ë°˜ í†µì‹ 
- **ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ **: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ ì¦‰ì‹œ ë°ì´í„° ì „ì†¡
- **ì„¸ì…˜ ê²©ë¦¬**: ê° ì‚¬ìš©ìë³„ ë…ë¦½ì ì¸ UI ì„¸ì…˜ ê´€ë¦¬
- **ìë™ ì¬ì—°ê²°**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ìë™ìœ¼ë¡œ ì—°ê²° ë³µêµ¬

### ğŸ¬ ì•¡ì…˜ ê¸°ë°˜ UI ì œì–´
- **í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì•¡ì…˜**: ë³´ì•ˆì„ ìœ„í•´ í—ˆìš©ëœ UI ì•¡ì…˜ë§Œ ì‹¤í–‰
- **ìë™ ë³€í™˜**: MCP íˆ´ ê²°ê³¼ë¥¼ ì ì ˆí•œ UI ì•¡ì…˜ìœ¼ë¡œ ìë™ ë³€í™˜
- **ì—ëŸ¬ ì²˜ë¦¬**: ì‹¤íŒ¨í•œ ì‘ì—…ì— ëŒ€í•œ ëª…í™•í•œ í”¼ë“œë°± ì œê³µ

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   í´ë¼ì´ì–¸íŠ¸    â”‚    â”‚   UI ë¸Œë¦¿ì§€     â”‚    â”‚   MCP ì„œë²„      â”‚
â”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚
â”‚ â€¢ Socket.IO     â”‚    â”‚ â€¢ SocketManager â”‚    â”‚ â€¢ fill_report   â”‚
â”‚ â€¢ ActionExecutorâ”‚    â”‚ â€¢ UIBridge      â”‚    â”‚ â€¢ validate_data â”‚
â”‚ â€¢ React UI      â”‚    â”‚ â€¢ MCPWrapper    â”‚    â”‚ â€¢ render_pdf    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ì„¤ì¹˜ ë° ì„¤ì •

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
npm install socket.io socket.io-client uuid
npm install --save-dev @types/uuid
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env íŒŒì¼
UI_BRIDGE_ENABLED=true
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
```

### 3. ì„œë²„ ì‹œì‘

```bash
npm run webapp
```

## ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•

1. **ì›¹ í˜ì´ì§€ ì ‘ì†**: ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000` ì ‘ì†
2. **ìë™ ì—°ê²°**: í˜ì´ì§€ ë¡œë“œ ì‹œ Socket.IO ì—°ê²°ì´ ìë™ìœ¼ë¡œ ì„¤ì •ë¨
3. **ì±„íŒ… ìš”ì²­**: "í•„ë“œ ìë™ìœ¼ë¡œ ì±„ì›Œì¤˜" ë“±ì˜ ë©”ì‹œì§€ ì…ë ¥
4. **ì‹¤ì‹œê°„ ë°˜ì˜**: ìš”ì²­í•œ ì‘ì—…ì´ í™”ë©´ì— ì¦‰ì‹œ ë°˜ì˜ë¨

### API ìš”ì²­ ì˜ˆì‹œ

```javascript
// ì±„íŒ… ìš”ì²­ ì‹œ uiSessionId í¬í•¨
const response = await fetch('/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    message: "í•„ë“œ ìë™ìœ¼ë¡œ ì±„ì›Œì¤˜",
    conversationId: "conv_123",
    apiKey: "your-openai-api-key",
    uiSessionId: "ui_1234567890_abc123" // ìë™ ìƒì„±ë¨
  })
});
```

### ì§€ì›í•˜ëŠ” UI ì•¡ì…˜

| ì•¡ì…˜ íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|-----------|------|------|
| `set_field` | ë‹¨ì¼ í•„ë“œ ê°’ ì„¤ì • | ì…ë ¥ í•„ë“œì— ê°’ ì…ë ¥ |
| `set_fields` | ì—¬ëŸ¬ í•„ë“œ ì¼ê´„ ì„¤ì • | ë³´ê³ ì„œ ì „ì²´ í¼ ì™„ì„± |
| `highlight_field` | í•„ë“œ ê°•ì¡° í‘œì‹œ | ì˜¤ë¥˜ í•„ë“œ ë¹¨ê°„ìƒ‰ ê°•ì¡° |
| `show_toast` | í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ | "ì‘ì—… ì™„ë£Œ" ì•Œë¦¼ |
| `open_panel` | íŒ¨ë„ ì—´ê¸° | ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ í‘œì‹œ |
| `start_pdf_render` | PDF ìƒì„± ì‹œì‘ | ì§„í–‰ë¥  í‘œì‹œê¸° í‘œì‹œ |
| `update_progress` | ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ | 50% â†’ 75% ì—…ë°ì´íŠ¸ |
| `end_pdf_render` | PDF ìƒì„± ì™„ë£Œ | ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ |

## ê°œë°œì ê°€ì´ë“œ

### ì„œë²„ ì¸¡ êµ¬í˜„

#### 1. Socket.IO ì„œë²„ ì„¤ì •

```javascript
// server/socket.ts
import { Server as SocketIOServer } from 'socket.io';

const io = new SocketIOServer(server, {
  cors: {
    origin: process.env.ALLOWED_ORIGINS?.split(',') || ["http://localhost:3000"],
    credentials: true
  }
});
```

#### 2. UI ë¸Œë¦¿ì§€ ì´ˆê¸°í™”

```javascript
// web_server.js
const socketManager = new SocketManager(server);
const uiBridge = new UIBridge(socketManager);
const mcpWrapper = new MCPWrapper(mcp, uiBridge);
```

#### 3. MCP íˆ´ ê²°ê³¼ë¥¼ UI ì•¡ì…˜ìœ¼ë¡œ ë³€í™˜

```javascript
// server/ui-translators.ts
const translator = new UITranslator({ uiSessionId, userId });
const actions = translator.translateToolResult(toolResult);
await uiBridge.emitActions(uiSessionId, actions);
```

### í´ë¼ì´ì–¸íŠ¸ ì¸¡ êµ¬í˜„

#### 1. ì†Œì¼“ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°

```javascript
// src/ui/socket.ts
import { uiSocketClient } from './socket';

await uiSocketClient.connect();
const sessionId = uiSocketClient.getUISessionId();
```

#### 2. ì•¡ì…˜ ì‹¤í–‰ê¸° ì„¤ì •

```javascript
// src/ui/action-executor.ts
import { actionExecutor } from './action-executor';

// UI ì•¡ì…˜ ìˆ˜ì‹  ì‹œ ìë™ ì‹¤í–‰
uiSocketClient.onAction('*', async (action) => {
  await actionExecutor.executeAction(action);
});
```

#### 3. ì»¤ìŠ¤í…€ ì•¡ì…˜ í•¸ë“¤ëŸ¬ ë“±ë¡

```javascript
// ì»¤ìŠ¤í…€ í•„ë“œ ì„¤ì • í•¸ë“¤ëŸ¬
actionExecutor.registerHandler('set_field', async (action) => {
  const { field, value } = action.payload;
  // ì‚¬ìš©ì ì •ì˜ ë¡œì§
  document.getElementById(field).value = value;
});
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì„¸ì…˜ ê²©ë¦¬
- ê° `uiSessionId`ëŠ” ë…ë¦½ì ì¸ ë£¸ìœ¼ë¡œ ê´€ë¦¬
- ì‚¬ìš©ì ê°„ ë°ì´í„° í˜¼ì¬ ë°©ì§€
- ì„¸ì…˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ìë™ ì •ë¦¬

### 2. ì•¡ì…˜ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
- í—ˆìš©ëœ UI ì•¡ì…˜ë§Œ ì‹¤í–‰ ê°€ëŠ¥
- ì„œë²„ì—ì„œ ìƒì„±ëœ ì•¡ì…˜ë§Œ ì‹ ë¢°
- í´ë¼ì´ì–¸íŠ¸ ì„ì˜ ì•¡ì…˜ ìƒì„± ì°¨ë‹¨

### 3. í˜ì´ë¡œë“œ ì œí•œ
- ìµœëŒ€ 1MB í˜ì´ë¡œë“œ í¬ê¸° ì œí•œ
- ê³¼ë„í•œ ë°ì´í„° ì „ì†¡ ë°©ì§€
- ì•…ì˜ì ì¸ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì°¨ë‹¨

## ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹…

### 1. ì„œë²„ ìƒíƒœ í™•ì¸

```bash
# UI ë¸Œë¦¿ì§€ ìƒíƒœ ì¡°íšŒ
GET /api/ui-bridge/status

# ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": {
    "uiBridge": {
      "enabled": true,
      "activeSessions": 3,
      "metrics": true
    },
    "mcpWrapper": {
      "enableUIBridge": true,
      "totalCalls": 25,
      "successfulCalls": 23
    }
  }
}
```

### 2. ì„¤ì • ì—…ë°ì´íŠ¸

```bash
# UI ë¸Œë¦¿ì§€ ì„¤ì • ë³€ê²½
POST /api/ui-bridge/config
{
  "enabled": true,
  "maxPayloadSize": 1048576,
  "enableMetrics": true
}
```

### 3. ë¸Œë¼ìš°ì € ì½˜ì†” ë””ë²„ê¹…

```javascript
// ê°œë°œ ëª¨ë“œì—ì„œ ì „ì—­ ê°ì²´ë¡œ ì ‘ê·¼ ê°€ëŠ¥
window.uiBridge.socket.getConnectionStatus();
window.uiBridge.executor.getMetrics();
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ì—°ê²° ê´€ë¦¬
- **ìë™ ì¬ì—°ê²°**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì§€ìˆ˜ ë°±ì˜¤í”„ë¡œ ì¬ì‹œë„
- **ì—°ê²° ëª¨ë‹ˆí„°ë§**: 30ì´ˆë§ˆë‹¤ ì—°ê²° ìƒíƒœ í™•ì¸
- **ì„¸ì…˜ ì •ë¦¬**: ë¹„í™œì„± ì„¸ì…˜ ìë™ ì œê±°

### 2. ë©”ëª¨ë¦¬ ê´€ë¦¬
- **ì•¡ì…˜ íˆìŠ¤í† ë¦¬**: ìµœê·¼ 100ê°œ ì‹¤í–‰ ì‹œê°„ë§Œ ìœ ì§€
- **ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ**: 30ë¶„ ë¹„í™œì„± ì‹œ ìë™ ì •ë¦¬
- **ê°€ë¹„ì§€ ì»¬ë ‰ì…˜**: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•¸ë“¤ëŸ¬ ìë™ ì •ë¦¬

### 3. ë°°ì¹˜ ì²˜ë¦¬
- **ì•¡ì…˜ ì¼ê´„ ì‹¤í–‰**: ì—¬ëŸ¬ ì•¡ì…˜ì„ í•œ ë²ˆì— ì²˜ë¦¬
- **ë¹„ë™ê¸° ì‹¤í–‰**: UI ë¸”ë¡œí‚¹ ë°©ì§€
- **ì—ëŸ¬ ê²©ë¦¬**: ê°œë³„ ì•¡ì…˜ ì‹¤íŒ¨ê°€ ì „ì²´ì— ì˜í–¥ ì£¼ì§€ ì•ŠìŒ

## ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. ì†Œì¼“ ì—°ê²° ì‹¤íŒ¨
```bash
# í™•ì¸ ì‚¬í•­
- ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
- CORS ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- ë°©í™”ë²½ì—ì„œ WebSocket í¬íŠ¸ ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸
```

#### 2. UI ì•¡ì…˜ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
```bash
# í™•ì¸ ì‚¬í•­
- uiSessionIdê°€ ìš”ì²­ì— í¬í•¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
- ì•¡ì…˜ ì‹¤í–‰ê¸°ê°€ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
- ë¸Œë¼ìš°ì € ì½˜ì†”ì— ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
```

#### 3. ì„±ëŠ¥ ë¬¸ì œ
```bash
# í™•ì¸ ì‚¬í•­
- í˜ì´ë¡œë“œ í¬ê¸°ê°€ 1MB ì´í•˜ì¸ì§€ í™•ì¸
- ë¶ˆí•„ìš”í•œ ì•¡ì…˜ì´ ë°˜ë³µ ìƒì„±ë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
- ì„¸ì…˜ ì •ë¦¬ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
```

### ë¡œê·¸ ë¶„ì„

```bash
# ì„œë²„ ë¡œê·¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì •ë³´
ğŸ”Œ Socket.IO ì„œë²„ ì´ˆê¸°í™” ì™„ë£Œ
ğŸ¯ UI ì„¸ì…˜ ì¡°ì¸: ui_1234567890_abc123
ğŸ“¡ MCP ê²°ê³¼ ì „ì†¡: ui_1234567890_abc123 -> fill_report
ğŸ¬ UI ì•¡ì…˜ ë¸Œë¦¿ì§€: ui_1234567890_abc123 -> 3ê°œ ì•¡ì…˜
```

## í™•ì¥ ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•

### 1. ìƒˆë¡œìš´ UI ì•¡ì…˜ ì¶”ê°€

```javascript
// ì„œë²„ ì¸¡: ë²ˆì—­ê¸°ì— ìƒˆ ì•¡ì…˜ íƒ€ì… ì¶”ê°€
case 'custom_action':
  return this.translateCustomAction(result);

// í´ë¼ì´ì–¸íŠ¸ ì¸¡: ì•¡ì…˜ ì‹¤í–‰ê¸°ì— í•¸ë“¤ëŸ¬ ë“±ë¡
actionExecutor.registerHandler('custom_action', async (action) => {
  // ì‚¬ìš©ì ì •ì˜ ë¡œì§
});
```

### 2. ì»¤ìŠ¤í…€ ë²ˆì—­ê¸° êµ¬í˜„

```javascript
// server/custom-translator.ts
export class CustomTranslator extends UITranslator {
  protected translateCustomTool(result: any): UIAction[] {
    // ì‚¬ìš©ì ì •ì˜ ë³€í™˜ ë¡œì§
    return [{
      type: 'custom_action',
      payload: { data: result },
      timestamp: Date.now(),
      sequence: 0
    }];
  }
}
```

### 3. ë©”íŠ¸ë¦­ í™•ì¥

```javascript
// ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­ ì¶”ê°€
class CustomMetrics extends BridgeMetrics {
  customMetric: number = 0;
  
  updateCustomMetric(value: number) {
    this.customMetric = value;
  }
}
```

## ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸

### v1.0-ui-bridge (í˜„ì¬ ë²„ì „)

#### ìƒˆë¡œìš´ ê¸°ëŠ¥
- âœ… Socket.IO ê¸°ë°˜ ì‹¤ì‹œê°„ í†µì‹ 
- âœ… MCP íˆ´ ê²°ê³¼ ìë™ UI ë³€í™˜
- âœ… ì„¸ì…˜ ê²©ë¦¬ ë° ë³´ì•ˆ
- âœ… ìë™ ì¬ì—°ê²° ë° ëª¨ë‹ˆí„°ë§
- âœ… ì•¡ì…˜ ê¸°ë°˜ UI ì œì–´

#### ê°œì„ ì‚¬í•­
- ğŸ”§ ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ë¡œì§ ê°•í™”
- ğŸ”§ ì„±ëŠ¥ ìµœì í™” ë° ë©”ëª¨ë¦¬ ê´€ë¦¬
- ğŸ”§ ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ê°œì„ 

#### ì•Œë ¤ì§„ ì´ìŠˆ
- âš ï¸ ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ WebSocket í´ë°± í•„ìš”
- âš ï¸ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡ ì‹œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±

## ë¼ì´ì„ ìŠ¤

MIT License - ììœ ë¡­ê²Œ ì‚¬ìš©, ìˆ˜ì •, ë°°í¬ ê°€ëŠ¥

## ê¸°ì—¬í•˜ê¸°

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ë¬¸ì˜ ë° ì§€ì›

- **ì´ìŠˆ ë¦¬í¬íŠ¸**: GitHub Issues ì‚¬ìš©
- **ê¸°ìˆ  ë¬¸ì˜**: ê°œë°œíŒ€ì— ì§ì ‘ ì—°ë½
- **ë¬¸ì„œ ê°œì„ **: Pull Requestë¡œ ì œì•ˆ

---

**ì°¸ê³ **: ì´ ë¬¸ì„œëŠ” UI ë¸Œë¦¿ì§€ v1.0ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìµœì‹  ì •ë³´ëŠ” ì½”ë“œë² ì´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
